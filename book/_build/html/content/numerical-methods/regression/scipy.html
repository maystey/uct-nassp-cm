

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Least Squares Minimization with scipy.optimize.leastsq &#8212; AST4007W Computational Methods</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../../../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/sphinx-book-theme.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <script src="../../../_static/togglebutton.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/mystnb.js"></script>
    <script src="../../../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Numerical Solutions to Ordinary Differential Equations" href="../ode/intro.html" />
    <link rel="prev" title="Multivariate Linear Least Squares Minimization" href="multivariate-least-squares.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../../index.html">
  
  <img src="../../../_static/UCTcircular_logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">AST4007W Computational Methods</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <p class="caption">
 <span class="caption-text">
  Introduction
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro/intro.html">
   Programming and Python in a Nutshell
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  The Python Standard Library
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../standard-library/basics/intro.html">
   Python Basics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../standard-library/data-structures/intro.html">
   Data Structures
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../standard-library/if-statements/intro.html">
   Control Flow: If Statements
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../standard-library/loops/intro.html">
   Control Flow: Loops
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../standard-library/functions/intro.html">
   Defining Functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../standard-library/file-io/intro.html">
   File I/O
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Scientific Packages
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../scientific-packages/numpy/intro.html">
   Numpy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../scientific-packages/matplotlib/intro.html">
   Matplotlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../scientific-packages/astropy/intro.html">
   Astropy
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Numerical Methods
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../benchmarking/intro.html">
   Benchmarking
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="reference internal" href="intro.html">
   Linear Regression Algorithms
  </a>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="least-squares.html">
     Linear Least Squares Minimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="chi-squared.html">
     Chi Squared Minimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="multivariate-least-squares.html">
     Multivariate Linear Least Squares Minimization
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Least Squares Minimization with
     <code class="docutils literal notranslate">
      <span class="pre">
       scipy.optimize.leastsq
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ode/intro.html">
   Numerical Solutions to Ordinary Differential Equations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../integration/intro.html">
   Numerical Integration Techniques
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../../_sources/content/numerical-methods/regression/scipy.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/maystey/uct-nassp-cm-2021"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/maystey/uct-nassp-cm-2021/issues/new?title=Issue%20on%20page%20%2Fcontent/numerical-methods/regression/scipy.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> On this page
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#an-example-of-a-nonlinear-model">
   An Example of a Nonlinear Model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#nonlinear-least-squares-minimization-with-scipy-optimize-leastsq">
   Nonlinear Least Squares Minimization with
   <code class="docutils literal notranslate">
    <span class="pre">
     scipy.optimize.leastsq
    </span>
   </code>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#solutions-converging-on-local-minima">
     Solutions Converging on Local Minima
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="least-squares-minimization-with-scipy-optimize-leastsq">
<h1>Least Squares Minimization with <code class="docutils literal notranslate"><span class="pre">scipy.optimize.leastsq</span></code><a class="headerlink" href="#least-squares-minimization-with-scipy-optimize-leastsq" title="Permalink to this headline">¶</a></h1>
<p>So far we have only considered functional relationships that are linear in the unknown constants. Non-linear cases are far more complicated and generally require numerical solutions. We will use a function from the SciPy module <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/optimize.html"><code class="docutils literal notranslate"><span class="pre">scipy.optimize</span></code></a>, which contains functions for minimization, least squares and root finding techniques.</p>
<div class="section" id="an-example-of-a-nonlinear-model">
<h2>An Example of a Nonlinear Model<a class="headerlink" href="#an-example-of-a-nonlinear-model" title="Permalink to this headline">¶</a></h2>
<p>Consider the data found in the data file <strong>nonlinear_data.csv</strong> on <a class="reference external" href="https://raw.githubusercontent.com/maystey/uct_nassp_cm/gh-pages/regression/data/nonlinear_data.csv">GitHub</a> , plotted below:</p>
<p>Though the data may appear to follow a linear trend, this is not the case. Consider the linear fit below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">leastsq</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1">#Remove input</span>

<span class="k">def</span> <span class="nf">lin_f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">x</span>

<span class="k">def</span> <span class="nf">lin_err</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">lin_f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span>

<span class="n">a0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]</span>

<span class="n">a</span><span class="p">,</span> <span class="n">success</span> <span class="o">=</span> <span class="n">leastsq</span><span class="p">(</span><span class="n">lin_err</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">))</span>

<span class="c1">#Plotting the fit and data</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xdata</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">xdata</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">1000</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="s1">&#39;bo&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lin_f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="s1">&#39;r-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/scipy_6_0.png" src="../../../_images/scipy_6_0.png" />
</div>
</div>
<p>Instead a more appropriate functional relation is an exponential function:</p>
<div class="math notranslate nohighlight">
\[
y = a_0 + a_1 e^{a_2 x}
\]</div>
<div class="cell tag_remove_input docutils container">
<div class="cell_output docutils container">
<img alt="../../../_images/scipy_8_0.png" src="../../../_images/scipy_8_0.png" />
</div>
</div>
<p>Note that this functional relation is non-linear in <span class="math notranslate nohighlight">\(a_2\)</span>. Applying the method of least squares minimization to this functional relation will not yield an analytic solution, therefore a numerical method is required. We shall not be implementing this numerical method ourselves, instead using a function from <strong>SciPy</strong> to solve our problem. In short the numerical minimization technique involves following the negative gradient (or an approximation of this) from a given starting point, until a local minimum is found (essentially the solution is captured here).</p>
<!---
Include a visual analogy of a ball rolling down a surface
---></div>
<div class="section" id="nonlinear-least-squares-minimization-with-scipy-optimize-leastsq">
<h2>Nonlinear Least Squares Minimization with <code class="docutils literal notranslate"><span class="pre">scipy.optimize.leastsq</span></code><a class="headerlink" href="#nonlinear-least-squares-minimization-with-scipy-optimize-leastsq" title="Permalink to this headline">¶</a></h2>
<p>The SciPy module <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/optimize.html"><code class="docutils literal notranslate"><span class="pre">scipy.optimize</span></code></a> contains functions for minimization, least squares and root finding techniques. Of particular interest to us now is the <code class="docutils literal notranslate"><span class="pre">leastsq</span></code> function (documentation <a class="reference external" href="https://docs.scipy.org/doc/scipy-0.19.0/reference/generated/scipy.optimize.leastsq.html">here</a>), which we shall use to perform nonlinear least squares minimization.</p>
<p>The call signature of <code class="docutils literal notranslate"><span class="pre">leastsq</span></code>, including only the arguments of immediate interest to us, is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">leastsq</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="p">()</span> <span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">x0</span></code> argument is an initial guess for the unknown parameters we are trying to find (required by the numerical minimization technique). In our case this is an initial case of the <span class="math notranslate nohighlight">\(a_j\)</span> constants.</p>
<p>The keyword argument <code class="docutils literal notranslate"><span class="pre">args</span></code> is a tuple of the variables or data we are fitting the model to. In our case <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span>. The order in which these variables are presented is up to you, but must correspond to the order they are used in <code class="docutils literal notranslate"><span class="pre">fun</span></code>. Each element of this tuple should be an array or list of data points, for instance <code class="docutils literal notranslate"><span class="pre">(xdata,</span> <span class="pre">ydata)</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">func</span></code> argument is a callable object (function). It is referred to as the residual. It is the sum of the residuals squared that will be minimized.For the sum of errors squared the residual is equivalent to our error terms (<span class="math notranslate nohighlight">\(\epsilon_i\)</span>).</p>
<!---
Mention that the sum of errors squared is called the objective function
--->
<div class="math notranslate nohighlight">
\[
S^2 = \sum_{i = 1}^{N} \text{func(arguments)}^2
\]</div>
<p>The call signature of <code class="docutils literal notranslate"><span class="pre">func</span></code> is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">func</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">params</span></code> is a list or array of the parameters we are trying to find (<span class="math notranslate nohighlight">\(a_j\)</span>), and <code class="docutils literal notranslate"><span class="pre">args</span></code> is the tuple of the data for our variables (<span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span>).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">*</span></code> operator before a sequence data structure in a function argument unpacks that data structure as if each element where entered into the function individually. For example <code class="docutils literal notranslate"><span class="pre">f(</span> <span class="pre">*(x,y,z)</span> <span class="pre">)</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">f(x,</span> <span class="pre">y,</span> <span class="pre">z)</span></code></p>
<p>The return value of the <code class="docutils literal notranslate"><span class="pre">leastsq</span></code> function (if it is only given the arguments listed above) is a tuple containing the solution for the <span class="math notranslate nohighlight">\(a_j\)</span> and an integer flag (for which a value between 1 and 4 indicates the solution was found).</p>
<p>Putting this all together, we can solve the problem from above:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1">#importing scipy.optimize.leastsq only</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">leastsq</span>

<span class="c1">#The model to fit to the data</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>

<span class="c1">#Residuals (in this case the error term)</span>
<span class="k">def</span> <span class="nf">err</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span>

<span class="c1">#Reading the data</span>
<span class="c1"># The `unpack` keyword argument seperates the columns into individual arrays </span>
<span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;data/nonlinear_data.csv&#39;</span><span class="p">,</span> <span class="n">delimiter</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">unpack</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> 

<span class="c1">#Performing the fit</span>
<span class="n">a0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]</span> <span class="c1">#initial guess</span>

<span class="n">a</span><span class="p">,</span> <span class="n">success</span> <span class="o">=</span> <span class="n">leastsq</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">))</span>

<span class="c1">#Plotting the fit and data</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xdata</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">xdata</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">1000</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="s1">&#39;bo&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="s1">&#39;r-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/scipy_16_0.png" src="../../../_images/scipy_16_0.png" />
</div>
</div>
<div class="section" id="solutions-converging-on-local-minima">
<h3>Solutions Converging on Local Minima<a class="headerlink" href="#solutions-converging-on-local-minima" title="Permalink to this headline">¶</a></h3>
<p>As mentioned before, the numerical algorithm is complete once it has minimized the objective function (the sum of errors squared in out case) to a <strong>local minimum</strong>. It is possible for the solution to not represent the global minimum, which is the ideal solution to obtain.</p>
<p>Let’s take a relatively simple example to illustrate this. Consider the functional relation:</p>
<div class="math notranslate nohighlight">
\[
y = a_0 + a_1 e^{-a_2 x} \sin(a_3 x)
\]</div>
<div class="cell tag_remove_input docutils container">
<div class="cell_output docutils container">
<img alt="../../../_images/scipy_19_0.png" src="../../../_images/scipy_19_0.png" />
</div>
</div>
<p>Given a set of data characterized by this relation:</p>
<div class="cell tag_remove_input docutils container">
<div class="cell_output docutils container">
<img alt="../../../_images/scipy_21_0.png" src="../../../_images/scipy_21_0.png" />
</div>
</div>
<p>It is relatively easy to find a good fit using <code class="docutils literal notranslate"><span class="pre">leastsq</span></code>:</p>
<div class="cell tag_remove_input docutils container">
<div class="cell_output docutils container">
<img alt="../../../_images/scipy_23_0.png" src="../../../_images/scipy_23_0.png" />
</div>
</div>
<p>Here are a couple of examples of solutions that returns a supposedly successful solution, but have obviously not converged to the best fit.</p>
<div class="cell tag_remove_input docutils container">
<div class="cell_output docutils container">
<img alt="../../../_images/scipy_25_0.png" src="../../../_images/scipy_25_0.png" />
</div>
</div>
<div class="cell tag_remove_input docutils container">
<div class="cell_output docutils container">
<img alt="../../../_images/scipy_26_0.png" src="../../../_images/scipy_26_0.png" />
</div>
</div>
<p>Here is an example of a solution that has not succeded (returned an integer flag greater than 4):</p>
<div class="cell tag_remove_input docutils container">
<div class="cell_output docutils container">
<div class="stderr docutils container">
<pre class="stderr literal-block">/home/mayhew/anaconda3/lib/python3.7/site-packages/scipy/optimize/minpack.py:449: RuntimeWarning: Number of calls to function has reached maxfev = 1000.
  warnings.warn(errors[info][0], RuntimeWarning)
</pre>
</div>
<img alt="../../../_images/scipy_28_1.png" src="../../../_images/scipy_28_1.png" />
</div>
</div>
<p>If your model does not fit, try varying the initial guess for the fit parameters.</p>
</div>
</div>
</div>


              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="multivariate-least-squares.html" title="previous page">Multivariate Linear Least Squares Minimization</a>
    <a class='right-next' id="next-link" href="../ode/intro.html" title="next page">Numerical Solutions to Ordinary Differential Equations</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Luis A. Balona, Ed Elson, Masimba Paradza and Mayhew Steyn<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../../../_static/js/index.js"></script>
    
  </body>
</html>